# Установка и настройка модуля на CMS 1С-Битрикс

# Содержание
* [Введение][m1]
* [Установка][m2]
  * [Шаг 1. Проверка корректности токенов][m3]
  * [Шаг 2. Деактивация свойств][m4] 
  * [Шаг 3. Финал][m5]
* [Настройки модуля][m6]
  * [Первичная настройка][m7]
  * [Использование модуля как оформление заказов][m8]
    * [Дополнительная настройка][m9]
    * [Замена компонента мини-корзины][m10]
    * [Замена компонента корзины и оформления заказа][m11]
  * [Использование модуля как расчет доставки][m12]
    * [Создание способа доставки][m13]
    * [Дополнительная настройка][m14]
  * [Расчет доставки в карточке товара][m15]

# Введение

Мы подготовили для Вас модуль, который интегрирует Salesbeat в магазины на 1C-Bitrix.
<br><br>
Если у вас что-то не получается, есть вопросы или предложения или просто нужна помощь по установке или настройке 
решения — пожалуйста, пишите нам в чат на нашем сайте [https://salesbeat.pro][l1] или на email hi@salesbeat.pro, мы 
с радостью поможем.
<br><br>
Модуль работает на версии Битрикс 16+. Если у вас версия младше и вы хотите воспользоваться нашим решением — напишите 
нам, возможно мы сможем это организовать.

# Установка

## Шаг 1. Проверка корректности токенов

![изображение1][i1]

Заполняем поля с **api-token** и **secret-token**, после нажимаем на «Проверить правильность токенов и продолжить
установку».

В случае указания неправильных токенов вы получите ошибку:

![изображение1][i2]

В случае успешной проверки, перейдете следующему шагу.

## Шаг 2. Деактивация свойств

![изображение1][i3]

*Если вы хотите использовать наш модуль не только как модуль доставки, а как полноценное оформление заказа, тогда 
можете пропустить данный шаг.*

Выбираем напротив типов свойствой, указанные свойства в желтом блоке предварительно зажав клавишу «**ctrl**» или 
«**command**». После нажимаем на «Деактивировать отмеченные свойства и продолжить установку».

## Шаг 3. Финал

![изображение14][i4]

Поздравляем! Модуль успешно установлен. Для дальнейшей настройки можете использовать описанную инструкцию в шаге 3, 
либо продолжить читать нашу инструкцию здесь.

#Настройки модуля

## Первичная настройка

![изображение5][i5]

Переходим на страницу настройки модуля «**Salesbeat**». Для этого в левом меню выбираем раздел «Настройки», после 
«Настройки продукта» -> «Настройки модулей» -> «Salesbeat». Теперь у вас откроется интерфейс для работы с модулем 
«**Salesbeat**».

![изображение6][i6]

Во вкладке «Общие настройки» заполняем поля в секции «Габариты по умолчанию».

![изображение7][i7]

Во вкладке «Платежные системы» сопоставляем платежные системы вашего магазина с типами оплаты (наличными, картой при 
получении или онлайн).

![изображение8][i8]

Во вкладке «О получателе» сопоставьте свойства заказа со всеми полями.

После выполненных выше этапов, **нажмите** на «Сохранить»

## Использование модуля как оформление заказов

### Дополнительная настройка

![изображение9][i9]

Переходим на страницу настройки модуля «**Salesbeat**», во вкладку «Модуль оформления заказов».

В секции «Тестирование» в поле АБ-тест укажите процент пользователей который сможет воспользоваться оформлением заказа 
через наш модуль*.<br>
**Если вы хотите использовать только наш модуль, напишите значение **100**.*

В секции «Каталог и свойства» выберите инфоблоки каталога и торговых предложений, а также выделите свойства товаров 
которые будут отображаться при оформлении заказа.

После выполненных выше этапов, **нажмите** на «Сохранить»

### Замена компонента мини-корзины

Для возможности оформления заказа без дополнительных переходов, установите компонент с нашей корзиной.

```php
if (\Bitrix\Main\Loader::includeModule('salesbeat.sale')):
  $APPLICATION->IncludeComponent(
      'salesbeat:sale.basket.small',
      '.default', // Шаблон компонента (Можете создать свой шаблон)
      [],
      false,
      []
  );
endif;
```

### Замена компонента корзины и оформления заказа

Для запрета оформления заказа через стандартные средства Bitrix, замените компоненты на странице корзины и оформления 
заказа, на предложенный нами ниже компонент.

```php
if (\Bitrix\Main\Loader::includeModule('salesbeat.sale')):
  $APPLICATION->IncludeComponent(
      'salesbeat:sale.order.ajax',
      '.default', // Шаблон компонента
      [
          'PATH_TO_PAYMENT' => '/personal/order/payment/', // Путь к странице подключения платежной системы (bitrix:sale.order.payment)
      ],
      false,
      []
  );
endif;
```

## Использование модуля как расчет доставки

### Создание способа доставки

![изображение10][i10]

Переходим на страницу создания способа доставки «**Salesbeat**». Для этого в левом меню выбираем раздел «Магазин», после 
«Настройки-> «Службы доставки». Теперь у вас откроется интерфейс для работы со службами доставок.

Нажмите на кнопку «Добавить» и выберите один из способов доставки «Salesbeat с виджетом» или «Salesbeat без виджета».

![изображение11][i11]

В случае добавления способа доставки «Salesbeat без виджета», то не забудьте в настройках службы добавить профили 
доставки.

Список профилей автоматически подгружается, исходя из выбранных служб доставки в вашем кабинете Salesbeat, управлять ими 
можно там же — [настройка тарифов][l2].

### Дополнительная настройка

![изображение12][i12]

Переходим на страницу настройки модуля «**Salesbeat**», во вкладку «Модуль служб доставки».

В секции «Шаблоны» выберите шаблон отображения доставок исходя из созданного вами способа доставки.

После выполненных выше этапов, **нажмите** на «Сохранить»

## Расчет доставки в карточке товара

Для того чтобы в товарной карточке отобразился виджет со способами, стоимостью и сроком доставки, необходимо добавить 
следующий код в шаблон компонента товарной карточки.

```php
if (\Bitrix\Main\Loader::includeModule('salesbeat.sale')):
   $APPLICATION->IncludeComponent(
       'salesbeat:sale.catalog.element.delivery',
       '.default', // Шаблон компонента (Можете создать свой шаблон)
       [
           'price_to_pay' => $price['RATIO_PRICE'], // Cумма наложенного платежа в рублях
           'price_insurance' => $price['RATIO_PRICE'], // Объявленная стоимость для страховки в рублях
           'weight' => '', // Вес в гр
           
           // Габариты в мм
           'x' => '',
           'y' => '',
           'z' => '',
           
           'quantity' => $price['MIN_QUANTITY'], // Количество товара (Не забывайте про кратность)
       ],
       false
   );
endif;
```



[m1]: #введение
[m2]: #установка
[m3]: #шаг-1-проверка-корректности-токенов
[m4]: #шаг-2-деактивация-свойств
[m5]: #шаг-3-финал
[m6]: #настройки-модуля
[m7]: #первичная-настройка
[m8]: #использование-модуля-как-оформление-заказов
[m9]: #дополнительная-настройка
[m10]: #замена-компонента-мини-корзины
[m11]: #замена-компонента-корзины-и-оформления-заказа
[m12]: #использование-модуля-как-расчет-доставки
[m13]: #создание-способа-доставки
[m14]: #дополнительная-настройка-1
[m15]: #расчет-доставки-в-карточке-товара

[l1]: https://salesbeat.pro/
[l2]: https://app.salesbeat.pro/#/delivery_services

[i1]: https://app.salesbeat.pro/static/bitrixcheckout/image5.png
[i2]: https://app.salesbeat.pro/static/bitrixcheckout/image6.png
[i3]: https://app.salesbeat.pro/static/bitrixcheckout/image8.png
[i4]: https://app.salesbeat.pro/static/bitrixcheckout/image12.png
[i5]: https://app.salesbeat.pro/static/bitrixcheckout/image11.png
[i6]: https://app.salesbeat.pro/static/bitrixcheckout/image9.png
[i7]: https://app.salesbeat.pro/static/bitrixcheckout/image2.png
[i8]: https://app.salesbeat.pro/static/bitrixcheckout/image10.png
[i9]: https://app.salesbeat.pro/static/bitrixcheckout/image4.png
[i10]: https://app.salesbeat.pro/static/bitrixcheckout/image1.png
[i11]: https://app.salesbeat.pro/static/bitrixcheckout/image3.png
[i12]: https://app.salesbeat.pro/static/bitrixcheckout/image7.png